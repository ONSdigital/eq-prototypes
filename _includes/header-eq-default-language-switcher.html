<style>
    .language-switcher {
        display : none;
        position: relative;
        top: -.25rem;
    }

    @media(min-width: 500px) {
        .language-switcher {
            display : block;
        }
    }

    .languages {
        position: absolute;
        right: 0;
        border: 1px solid #999;
        background-color: #fff;
        border-radius: 3px;
    }

    .language-switcher__selected,
    .language-switcher__link {
        display : block;
        padding : .2rem .5rem;
    }

    .language-switcher__items {
        display : none;
        margin-bottom : 0;
        padding : 0;
        list-style-type : none;
    }

    .language-switcher__item {
        margin-bottom : 0;
    }

    .language-switcher__item {
        border-top : 1px solid #999;
    }

    .language-switcher__selected,
    .language-switcher__selected:hover,
    .language-switcher__selected:active,
    .language-switcher__selected:focus {
        width : 8rem;
        line-height : 1.6rem;
        text-align : left;
        font-weight : normal;
        color : #000;
        background: none;
        border: none;
        transition : none;
    }

    .language-switcher__selected::after {
        position: absolute;
        right: 10px;
        height: 20px;
        width: 20px;
        content: "";
        background-image: url('https://sdc-global-design-patterns.netlify.com/assets/img/icons/icons--chevron-right-blue-hover.svg');
        background-repeat: no-repeat;
        background-size: 10px;
        background-position: 92% center;
        transform: rotate(90deg);
    }

    .choose-language {
        position : relative;
        top : .3rem;
    }

    .language-switcher__items--open {
        display: block;
    }
</style>

<header class="header">
    <div class="header__top" role="banner">
        <div class="container">
            <div class="grid grid--gutterless">
                <div class="grid__col col-6@s">
                    <div class="logo">
                        <img src="https://deploy-preview-129--sdc-global-design-patterns.netlify.com/assets/img/ons-logo-black-en.svg" alt="Office for National Statistics logo" class="logo__img header__logo--print">
                        <a href="{{ site.baseurl }}/">
                            <img src="https://deploy-preview-129--sdc-global-design-patterns.netlify.com/assets/img/ons-logo-pos.svg" alt="Office for National Statistics logo" class="logo__img header__logo print__hidden">
                        </a>
                    </div>
                </div>
                <div class="grid__col col-6@s">
                    <div class="language-switcher js-language-switcher">
                        <a class="choose-language u-fr"
                           href="../languages">Choose language</a>
                        <div class="languages" style="display:none;">
                            <button
                                class="btn language-switcher__selected js-language-switcher-selected"
                                aria-haspopup="true"
                                aria-expanded="false"
                                aria-controls="language-switcher-items">
                                English
                            </button>
                            <ul id="language-switcher-items"
                                class="language-switcher__items js-language-switcher-items"
                                role="menu">
                                <li id="english-item"
                                    class="language-switcher__item">
                                    <a
                                            class="language-switcher__link js-language-switcher-item" href="" role="menuitem" data-language-item="english">
                                        English
                                    </a>
                                </li>
                                <li id="welsh-item"
                                    class="language-switcher__item">
                                    <a class="language-switcher__link js-language-switcher-item" href="" role="menuitem" data-language-item="welsh">
                                        Cymraeg
                                    </a>
                                </li>
                                <li id="polish-item"
                                    class="language-switcher__item">
                                    <a class="language-switcher__link js-language-switcher-item" href="" role="menuitem" data-language-item="polish">
                                        Polskie
                                    </a>
                                </li>

                                <!--<li class="language-switcher__item">
                                    <a class="language-switcher__link js-language-switcher-item" href="" role="menuitem">
                                        Gàidhlig
                                    </a>
                                </li>
                                <li class="language-switcher__item">
                                    <a class="language-switcher__link js-language-switcher-item" href="" role="menuitem">
                                        Ulstèr-Scotch
                                    </a>
                                </li>
                                <li class="language-switcher__item">
                                    <a class="language-switcher__link js-language-switcher-item"
                                       href="../languages/">
                                        All languages
                                    </a>
                                </li>-->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="header__main ">
        <div class="container">
            <div class="grid grid--gutterless grid--align-mid u-cf">
                <div class="grid__col ">
                    <h1 class="header__title header__title--nav-adj">
                        <span class="js-header-title">
                            {% if page.title %}
                                {{ page.title }}
                            {% else %}
                                {{ site.title }}
                            {% endif %}
                        </span>
                        <button class="btn btn--ghost u-fr">
                            {% if page.language == 'polish' %}
                            Zapisz i uzupełnij później
                            {% else if page.language == 'welsh' %}
                            Cadw a chwblhau'n ddiweddarach
                            {% else %}
                            Save and complete later
                            {% endif %}</button>
                    </h1>
                </div>
            </div>
        </div>
    </div>
</header>


<script>
    var language = "{% if page.language %}{{page.language}}{% else %}english{% endif %}",
      languageMap = {
        'english': {
          elId: 'english-item',
          label: 'English',
          fragment: '/'
        },
        'welsh': {
          elId: 'welsh-item',
          label: 'Cymraeg',
          fragment: '-cy/'
        },
        'polish': {
          elId: 'polish-item',
          label: 'Polskie',
          fragment: '-po/'
        }
      };

    $(function () {
      var $scopeEl = $('.js-language-switcher');
      var $switcher = $scopeEl.find('.js-language-switcher-selected');
      var clickedStateProperty = 'data-language-item-clicked';
      var switcherOpenClass = 'language-switcher__selected--open';
      var itemsOpenClass = 'language-switcher__items--open';
      var listAnchorClass = 'js-language-switcher-item';
      var $listAnchors = $scopeEl.find('.' + listAnchorClass);
      var $list = $scopeEl.find('.js-language-switcher-items');

      /**
       * Setup language selector
       */
      $('#' + languageMap[language].elId).remove();
      $('.choose-language').hide();
      $('.languages').show();
      $switcher.html(languageMap[language].label);

      $switcher.on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        toggle($switcher.hasClass(switcherOpenClass)
          ? 'hide'
          : 'show');
      });

      $switcher.on('keydown', function(e) {
        if(e.key === 'ArrowDown' && $switcher.hasClass(switcherOpenClass)) {
          e.preventDefault();

          setSwitcherProp(true);
          $list.find('.' + listAnchorClass + ':first').trigger('focus');
        }
      });

      function setSwitcherProp(val) {
        $switcher.attr(clickedStateProperty, val);
      }

      $listAnchors.on('mousedown', setSwitcherProp.bind(null, true));

      $listAnchors.on('keydown', function(e) {
        var $this = $(this),
            keyMap = {
              'ArrowDown': function () {
                e.preventDefault();
                var $nextEl = $this.parent().next();

                $nextEl && $nextEl.find('.' + listAnchorClass).trigger('focus');
              },
              'ArrowUp': function () {
                e.preventDefault();
                var $prevEl = $this.parent().prev();

                $prevEl[0] &&
                    $prevEl.find('.' + listAnchorClass).trigger('focus');
              }
            };

        var funcFound = keyMap[e.key];

        funcFound && funcFound();
      });

      $listAnchors.on('click', function (e) {
        e.preventDefault();

        var url = '',
          chosen = $(this).attr('data-language-item'),
          currentLanguageFragment = languageMap[language].fragment,
          chosenLanguageFragment = languageMap[chosen].fragment;

        if(language === 'english') {
          var pieces = window.location.href.split('/');
          url = pieces.slice(0, pieces.length-1).join('/') + chosenLanguageFragment;
        }
        else {
          url = window.location.href.replace(currentLanguageFragment, chosenLanguageFragment);
        }

        window.location.href = url;
      });

      document.addEventListener('mouseup', function  () {
        toggle('hide');
      });

      $switcher.on('blur', function () {
        if($switcher.attr(clickedStateProperty) !== 'true') {
          toggle('hide');
        }
      });

      function toggle(description) {
        var jQMethod = description === 'show' ? 'addClass' : 'removeClass';

        $switcher[jQMethod](switcherOpenClass);
        $list[jQMethod](itemsOpenClass);
      }
    });

</script>
