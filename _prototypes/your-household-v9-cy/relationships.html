---
title: Household prototype v9 - Welsh
project: your-household
globalcss: false
householdMembers:
visitors:
layout: eq-default-extras
cdn: v1.5.0
---

<script>
    var welshQuestionMutations = {
      'husband-wife': 'ŵr neu wraig',
      'same-sex-partner': 'bartner sifil cofrestredig cyfreithiol',
      'partner': 'bartner',
      'son-daughter': 'fab neu ferch',
      'step-child': 'llysblentyn',
      'brother-sister': 'frawd neu chwaer',
      'mother-father': 'Mam neu dad',
      'step-brother-sister': 'llysfrawd neu lyschwaer',
      'step-mother-father': 'llysfam neu lystad',
      'grandchild': 'ŵyr neu wyres',
      'grandparent': 'nain/mam-gu neu daid/tad-cu',
      'other-relation': 'berthynas arall',
      'unrelated': 'perthyn'
    };
</script>

<link rel="stylesheet" href="../style.css"/>
<div class="page__subheader">
    <div class="container">
        <a class="js-previous-link mars" href="../summary">Yn flaenorol</a>
    </div>
</div>

<div class="page__container container">
    <div class="grid grid--reverse">
        <div class="grid__col col-4@m">
            <!--{% include navigation.html
            items=site.data.your-household-v6.navigationItemsRelationships
            nav-title-id="section-address" %}-->
        </div>
        <div class="grid__col col-7@m pull-1@m">
            <main role="main" id="main" class="page__main">
                <form name="trav" class="form qa-questionnaire-form" role="form"
                      autocomplete="off" novalidate="">
                    <div class="group">
                        <div class="block">
                            <section class="section" id="question-area">
                                <div class="question">
                                    <h1 class="question__title saturn">
                                        <span class="js-relationship-person-is-relationship-description">...</span>
                                    </h1>
                                    <p class="question__description">
                                        Cwblhewch y frawddeg drwy ddewis
                                        y berthynas briodol.
                                    </p>

                                    <div class="answer__fields js-fields">
                                        <div class="field field--radio field--multiplechoice u-mb-l">
                                            <fieldset class="grid">
                                                <div class="grid__col col-8@m">
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="husband-wife"
                                                               value="husband-wife"/>
                                                        <label class="label label--inline u-width-fill venus"
                                                               for="husband-wife">Gŵr neu wraig</label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="same-sex-partner"
                                                               value="same-sex-partner"/>
                                                        <label class="label label--inline venus"
                                                               for="same-sex-partner">
                                                            Partner sifil cofrestredig
                                                            cyfreithiol
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="partner"
                                                               value="partner"/>
                                                        <label class="label label--inline venus"
                                                               for="partner">
                                                            Partner
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="son-daughter"
                                                               value="son-daughter"/>
                                                        <label class="label label--inline venus"
                                                               for="son-daughter">
                                                            Mab neu ferch
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="step-child"
                                                               value="step-child"/>
                                                        <label class="label label--inline venus"
                                                               for="step-child">
                                                            Llysblentyn
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="brother-sister"
                                                               value="brother-sister"/>
                                                        <label class="label label--inline venus"
                                                               for="brother-sister">
                                                            Brawd neu chwaer
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="step-brother-sister"
                                                               value="step-brother-sister"/>
                                                        <label class="label label--inline venus"
                                                               for="step-brother-sister">
                                                            Llysfrawd neu lyschwaer
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="mother-father"
                                                               value="mother-father"/>
                                                        <label class="label label--inline venus"
                                                               for="mother-father">
                                                            Mam neu dad
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="step-mother-father"
                                                               value="step-mother-father"/>
                                                        <label class="label label--inline venus"
                                                               for="step-mother-father">
                                                            Llysfam neu lysdad
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input--radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="grandchild"
                                                               value="grandchild"/>
                                                        <label class="label label--inline venus"
                                                               for="grandchild">
                                                            Ŵyr neu wyres
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input&#45;&#45;radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="grandparent"
                                                               value="grandparent"/>
                                                        <label class="label label&#45;&#45;inline venus"
                                                               for="grandparent">
                                                            Nain/mam-gu neu
                                                            daid/tad-cu
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input&#45;&#45;radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="other-relation"
                                                               value="other-relation"/>
                                                        <label class="label label&#45;&#45;inline venus"
                                                               for="other-relation">
                                                            Perthynas arall
                                                        </label>
                                                    </div>
                                                    <div class="field__item js-focusable-box">
                                                        <input class="input input&#45;&#45;radio js-focusable"
                                                               type="radio"
                                                               name="relationship"
                                                               id="unrelated"
                                                               value="unrelated"/>
                                                        <label class="label label&#45;&#45;inline venus"
                                                               for="unrelated">
                                                            Ddim yn perthyn
                                                            <span class="pluto u-db">Gan gynnwys plentyn maeth</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                        <fieldset class="grid">
                                            <div class="grid__col col-8@m">
                                                <div class="js-relationship-answer-feedback u-mb-xl answer-feedback"></div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                    <button class="btn btn--primary btn--lg qa-btn-submit venus"
                            type="submit" name="">Cadw a pharhau
                    </button>

                </form>
            </main>
        </div>
    </div>
</div>

<style>
    .field--multiplechoice .field__item {
        margin-right: 0;
        width: 100%;
        min-width: 0;
        vertical-align: top;
    }

    .label .label--negative {
        margin-left: -1.9rem;
    }

    .u-width-fill {
        width: 100%;
        min-width: 0;
    }

    .answer-feedback {
        padding : 1rem;
        border : 1px solid #999;
        background-color : #eee;
    }
</style>

<script src='/js/compiled/your-household-v9-cy/bundle.js'></script>

<script>
  var storageAPI = window.ONS.storage,
    personIs,
    personTo,

    urlParams = new URLSearchParams(window.location.search),
    editRelationshipId = urlParams.get('edit'),
    redirect = urlParams.get('redirect'),
    editRelationshipFound = null,

    surveyType = urlParams.get('survey'),
    nextPageSurveyRouting = surveyType ? '&survey=' + surveyType : '';

  function updateAnswer(missingRelationship, relationshipDescription, k) {
    var personIs = missingRelationship.personIs,
      personTo = missingRelationship.personTo;

    var personToIsMe = personTo['@person'].id ===
      storageAPI.IDS.USER_HOUSEHOLD_MEMBER_ID;

    var isNotFamilyDescription = relationshipDescription &&
      ['unrelated'].indexOf(
        relationshipDescription.type.id
      ) !== -1;

    var gap2 = isNotFamilyDescription
      ? " yw "
      : (personToIsMe
          ? " yw eich"
          : " yw " + personTo['@person'].fullName /*+
          window.ONS.utils.trailingNameS(personTo['@person'].fullName)*/
      );

    var gap3 = " to " + (personToIsMe ? ' you' : personTo['@person'].fullName);

    function standardText() {
      return personIs['@person'].fullName +

        gap2 +

        '<strong>' +
        (relationshipDescription &&
          (' ' + relationshipDescription.sentanceLabel) ||
          " ...") +
        '</strong>' +

        /**
         * Conditionally show if not family description
         */
        (isNotFamilyDescription ? gap3 : '');
    }

    $('.js-relationship-answer-feedback').html(
      (k && k === 'unrelated')
        ? 'Nid yw ' + personIs['@person'].fullName +
          ' yn <strong>perthyn</strong> i ' +
          (personToIsMe ? 'chi' : personTo['@person'].fullName)
        : standardText()
    );
  }

  function updateQuestion(missingRelationship, relationshipDescription, k) {
    var personIs = missingRelationship.personIs,
      personTo = missingRelationship.personTo;

    /*var isNotFamilyDescription = relationshipDescription &&
      ['unrelated'].indexOf(
        relationshipDescription.type.id
      ) !== -1;*/

    var personToIsMe = personTo['@person'].id ===
        storageAPI.IDS.USER_HOUSEHOLD_MEMBER_ID;
    
    var gap1 = "Gan feddwl am " + personTo['@person'].fullName +
      ", <br /> " + (k === 'unrelated' ? 'nid yw' : 'mae') + ' ';

    var gap2 = personToIsMe ? " yw eich" : " yn";

    var gap3 = ' i ' + personTo['@person'].fullName;
    //var gap3Your = ' i ' + personTo['@person'].fullName;

    function standardText() {
      /**
       * Conditionally show if question is not about me
       */
      return (!personToIsMe ? gap1 : '') +

          personIs['@person'].fullName + gap2 +
          " <span class='highlight'>" +
          (relationshipDescription && welshQuestionMutations[k] ||
            "...") +
          "</span>" +

          (!personToIsMe ? gap3 : '');
    }

    $('.js-relationship-person-is-relationship-description').html(
      (personToIsMe && k && k === 'unrelated')
        ? 'Nid yw ' + personIs['@person'].fullName + ' yn <span class=\'highlight\'>perthyn</span> i chi'
        : standardText()
    );
  }

  function getChosenItem() {
    var val = $('[name="relationship"]:checked').val();

    return {
      val: val,
      description: storageAPI.relationshipDescriptionMap[val]
    };
  }

  /**
   * Edit relationship page setup
   */
  function journeyEditRelationship() {
    editRelationshipFound = storageAPI.getAllRelationships()
      .filter(function(relationship) {
        return relationship.id + '' === editRelationshipId;
      })[0];

    if (editRelationshipFound) {
      personIs = storageAPI
        .getHouseholdMemberByPersonId(editRelationshipFound.personIsId);
      personTo = storageAPI
        .getHouseholdMemberByPersonId(editRelationshipFound.personToId);

      updateQuestion({
        personIs: personIs,
        personTo: personTo
      });

      updateAnswer({
        personIs: personIs,
        personTo: personTo
      });

      $('.qa-btn-submit')
        .on('click', editSubmit_handler.bind(null, editRelationshipId));
    }
    else {
      $('#question-area')
        .html('<h1 class="saturn">Relationship not found</h1>');
    }
  }

  function editSubmit_handler(relationshipId, e) {
    e.preventDefault();

    var chosenItem = getChosenItem(),
      relationshipDescriptionVal = chosenItem.val,
      relationshipDescription = chosenItem.description,
      aRelationshipPreviouslyInferredByThis = false;

    if (!relationshipDescription) {
      throw Error('Relationship description not found: ', relationshipDescription);
    }

    storageAPI.editRelationship(relationshipId,
      storageAPI.TYPES.relationship(
        relationshipDescriptionVal,
        editRelationshipFound.personIsId,
        editRelationshipFound.personToId,
      )
    );

    /**
     * Were there any relationships created by inference when
     * previously creating this relationship
     */
    $.each(storageAPI.getAllRelationships().filter(storageAPI.isRelationshipInferred),
      function(i, relationship) {
        var isInferredByThis = !!_.find(relationship.inferredBy, function(id) {
          return id+'' === relationshipId+'';
        });

        if(isInferredByThis) {
          storageAPI.deleteRelationship(relationship);
          aRelationshipPreviouslyInferredByThis = true;
        }
      });

    if(aRelationshipPreviouslyInferredByThis) {
      dynamicRouting();
    }
    else {
      window.location.href = '../relationships-summary-proxy/?noop=1' +
        nextPageSurveyRouting;
    }
  }

  /**
   * Create relationship page setup
   */
  function journeyCreateNewRelationship() {
    var missingRelationship = storageAPI.findNextMissingRelationship();

    if (missingRelationship) {
      personIs = missingRelationship.personTo;
      personTo = missingRelationship.personIs;

      updateQuestion({
        personIs: personIs,
        personTo: personTo
      });

      updateAnswer({
        personIs: personIs,
        personTo: personTo
      });

      $('.qa-btn-submit').on('click', missingSubmit_handler);
    }
    else {
      $('#question-area')
        .html('<h1 class="saturn">No missing relationships found</h1>');
      $('.qa-btn-submit').on('click', function(e) {
        e.preventDefault();

        window.location.href = '../relationships-summary-proxy/?noop=1' + nextPageSurveyRouting;
      });
    }
  }

  function missingSubmit_handler(e) {
    e.preventDefault();

    var nextMissingRelationship,
      chosenItem = getChosenItem(),
      relationshipDescriptionVal = chosenItem.val,
      relationshipDescription = chosenItem.description,
      newRelationship,
      dbRelationshipId;

    if (!relationshipDescription) {
      throw Error('Relationship description not found: ', relationshipDescription);
    }

    newRelationship = storageAPI.addRelationship(
      storageAPI.TYPES.relationship(
        relationshipDescriptionVal,
        personIs['@person'].id,
        personTo['@person'].id
      )
    );

    dbRelationshipId = newRelationship.id;

    window.history.replaceState(null, '', '?edit=' + dbRelationshipId + nextPageSurveyRouting);

    storageAPI.inferRelationships(newRelationship, personIs, personTo);

    nextMissingRelationship = storageAPI.findNextMissingRelationship();

    /**
     * Routing
     */
    if(redirect) {
      window.location.href = redirect;
    }
    else if (nextMissingRelationship) {
      dynamicRouting();
    }
    else {
      window.location.href = '../relationships-summary-proxy/?noop=1' +
        nextPageSurveyRouting;
    }
  }

  function dynamicRouting() {
      var personIsId = personIs['@person'].id,
        personToId = personTo['@person'].id,
        chosenItem = getChosenItem(),
        relationshipDescriptionVal = chosenItem.val,
        subjectPersonId,
        subjectRelationshipDescription;

      /**
       * Question strategies
       *
       * If child-parent relationship type was selected
       * and there are missing relationships for this person
       */
      if(relationshipDescriptionVal === 'mother-father' &&
        storageAPI.getPeopleIdsMissingRelationshipsWithPerson(personIsId).length) {
        subjectPersonId = personIsId;
      }
      else if(relationshipDescriptionVal === 'son-daughter' &&
        storageAPI.getPeopleIdsMissingRelationshipsWithPerson(personToId).length) {
        subjectPersonId = personToId;
        subjectRelationshipDescription = 'mother-father';
      }
      else if(relationshipDescriptionVal === 'unrelated' &&
        storageAPI.getPeopleIdsMissingRelationshipsWithPerson(personIsId).length &&

        /**
         * And personIs already has the same relationship type with someone
         * else
         */
        storageAPI.getAllManualRelationships()
          .filter(storageAPI.isInRelationship.bind(null, personIsId))
          .filter(storageAPI.isRelationshipType.bind(null, relationshipDescriptionVal))
          .length > 1
      ) {
        subjectPersonId = personIsId;
      }

      subjectRelationshipDescription = subjectRelationshipDescription ||
        relationshipDescriptionVal;

      if(subjectPersonId) {
        window.location.href = '../relationships-person-select/?person=' +
          subjectPersonId + '&relationship-description=' +
          subjectRelationshipDescription +
          nextPageSurveyRouting;
      }
      else {
        window.location.href = '../relationships/?noop=1' +
          nextPageSurveyRouting;
      }
  }

  $('[name="relationship"]').on('change', function() {
    const relationshipDescription = storageAPI.relationshipDescriptionMap[$(this).val()];
    updateQuestion({
      personIs: personIs,
      personTo: personTo
    }, relationshipDescription, $(this).val());

    updateAnswer({
      personIs: personIs,
      personTo: personTo
    }, relationshipDescription, $(this).val());
  });

  $(function() {

    /**
     * Code branching - are we trying to edit or create a new relationship
     */
    if (editRelationshipId) {
      journeyEditRelationship();
    }
    else {
      journeyCreateNewRelationship();
    }
  });
</script>
